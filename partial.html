<html>

<head>
	<meta charset="UTF-8" />
	<title> partial.js </title>
	<script src="partial.js"></script>
</head>

<body>

	<script>

		var users = [
			{ id: 101, name: 'ID' },
			{ id: 102, name: 'BJ' },
			{ id: 103, name: 'PJ' },
			{ id: 104, name: 'HA' },
			{ id: 105, name: 'JE' },
			{ id: 106, name: 'JI' }
		]

		var posts = [
			{ id: 201, body: '내용1', user_id: 101 },
			{ id: 202, body: '내용2', user_id: 102 },
			{ id: 203, body: '내용3', user_id: 103 },
			{ id: 204, body: '내용4', user_id: 102 },
			{ id: 205, body: '내용5', user_id: 101 }
		]

		var comments = [
			{ id: 301, body: '댓글1', user_id: 105, post_id: 201 },
			{ id: 302, body: '댓글2', user_id: 104, post_id: 201 },
			{ id: 303, body: '댓글3', user_id: 104, post_id: 202 },
			{ id: 304, body: '댓글4', user_id: 105, pwwost_id: 203 },
			{ id: 305, body: '댓글5', user_id: 106, post_id: 203 },
			{ id: 306, body: '댓글6', user_id: 106, post_id: 204 },
			{ id: 307, body: '댓글7', user_id: 102, post_id: 205 },
			{ id: 308, body: '댓글8', user_id: 103, post_id: 204 },
			{ id: 309, body: '댓글9', user_id: 103, post_id: 202 },
			{ id: 310, body: '댓글10', user_id: 105, post_id: 201 }
		]

		// 1. 특정 게시글에 등록된 모든 댓글 찾기.
		_.go(
			// _.filter(posts, post => post.user_id == '101'),
			// posts => _.filter(comments, comment => _.find(posts, post => post.id == comment.post_id)),
			_.where(posts, { user_id: 101 }),
			posts => _.filter(comments, comment => _.find(posts, post => post.id == comment.post_id)),
			// console.log
		)

		// 2. 특정 게시글에 등록된 모든 댓글의 사람이름 찾기.
		var post_by = obj => _.where(posts, obj);
		var comments_by_posts = _.pipe(
			_.pluck('id'),
			posts_ids => _.filter(comments, comment => _.contains(posts_ids, comment.post_id)),
		)
		var comments_to_user_names = _.pipe(
			_.map(comment => _.find(users, user => user.id == comment.user_id)),
			_.pluck('name')
		)

		var p1 = _.pipe(post_by, comments_by_posts);
		// console.log(p1({user_id: 101}));

		var p2 = _.pipe(
			p1,
			comments_to_user_names,
			_.uniq
		);
		// console.log(p2({user_id: 101}));

		// 3. 특정 게시글에 댓글을 적은 사람의 인원수 찾기.
		var p3 = _.pipe(
			p1,
			comments_to_user_names,
			_.count_by
		);
		console.log(p3({ user_id: 101 }));

		// 4. 특정 댓글이 적힌 게시글 찾기.
		var comments_by = obj => _.where(comments, obj);
		_.go(
			comments_by({ user_id: 105 }),
			_.pluck('post_id'),
			_.uniq,
			posts_ids => _.filter(posts, post => _.contains(posts_ids, post.id)),
			console.log
		);

	</script>

</body>

</html>